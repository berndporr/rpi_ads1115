\doxysection{ads1115rpi.\+h}
\hypertarget{ads1115rpi_8h_source}{}\label{ads1115rpi_8h_source}
\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#ifndef\ \_\_ADS1115RPI\_H}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#define\ \_\_ADS1115RPI\_H}}
\DoxyCodeLine{00003\ }
\DoxyCodeLine{00004\ \textcolor{comment}{/*}}
\DoxyCodeLine{00005\ \textcolor{comment}{\ *\ ADS1115\ class\ to\ read\ data\ at\ a\ given\ sampling\ rate}}
\DoxyCodeLine{00006\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00007\ \textcolor{comment}{\ *\ Copyright\ (c)\ 2007\ \ MontaVista\ Software,\ Inc.}}
\DoxyCodeLine{00008\ \textcolor{comment}{\ *\ Copyright\ (c)\ 2007\ \ Anton\ Vorontsov\ <avorontsov@ru.mvista.com>}}
\DoxyCodeLine{00009\ \textcolor{comment}{\ *\ Copyright\ (c)\ 2013-\/2025\ \ Bernd\ Porr\ <mail@berndporr.me.uk>}}
\DoxyCodeLine{00010\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00011\ \textcolor{comment}{\ *\ This\ program\ is\ free\ software;\ you\ can\ redistribute\ it\ and/or\ modify}}
\DoxyCodeLine{00012\ \textcolor{comment}{\ *\ it\ under\ the\ terms\ of\ the\ GNU\ General\ Public\ License\ as\ published\ by}}
\DoxyCodeLine{00013\ \textcolor{comment}{\ *\ the\ Free\ Software\ Foundation;\ either\ version\ 2\ of\ the\ License.}}
\DoxyCodeLine{00014\ \textcolor{comment}{\ *}}
\DoxyCodeLine{00015\ \textcolor{comment}{\ */}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#include\ <stdint.h>}}
\DoxyCodeLine{00017\ \textcolor{preprocessor}{\#include\ <unistd.h>}}
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#include\ <stdio.h>}}
\DoxyCodeLine{00019\ \textcolor{preprocessor}{\#include\ <stdlib.h>}}
\DoxyCodeLine{00020\ \textcolor{preprocessor}{\#include\ <assert.h>}}
\DoxyCodeLine{00021\ \textcolor{preprocessor}{\#include\ <linux/i2c-\/dev.h>}}
\DoxyCodeLine{00022\ \textcolor{preprocessor}{\#include\ <thread>}}
\DoxyCodeLine{00023\ \textcolor{preprocessor}{\#include\ <gpiod.hpp>}}
\DoxyCodeLine{00024\ \textcolor{preprocessor}{\#include\ <functional>}}
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00026\ \textcolor{comment}{//\ enable\ debug\ messages\ and\ error\ messages\ to\ stderr}}
\DoxyCodeLine{00027\ \textcolor{preprocessor}{\#ifndef\ NDEBUG}}
\DoxyCodeLine{00028\ \textcolor{preprocessor}{\#define\ DEBUG}}
\DoxyCodeLine{00029\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{00030\ }
\DoxyCodeLine{00031\ \textcolor{keyword}{static}\ \textcolor{keyword}{const}\ \textcolor{keywordtype}{char}\ could\_not\_open\_i2c[]\ =\ \textcolor{stringliteral}{"{}Could\ not\ open\ I2C.\(\backslash\)n"{}};}
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{preprocessor}{\#define\ ISR\_TIMEOUT\_MS\ 500}}
\DoxyCodeLine{00034\ }
\DoxyCodeLine{00035\ \textcolor{comment}{//\ default\ address\ if\ ADDR\ is\ pulled\ to\ GND}}
\DoxyCodeLine{00036\ \textcolor{preprocessor}{\#define\ DEFAULT\_ADS1115\_ADDRESS\ 0x48}}
\DoxyCodeLine{00037\ }
\DoxyCodeLine{00038\ \textcolor{comment}{//\ default\ GPIO\ pin\ for\ the\ ALRT/DRY\ signal}}
\DoxyCodeLine{00039\ \textcolor{preprocessor}{\#define\ DEFAULT\_ALERT\_RDY\_TO\_GPIO\ 17}}
\DoxyCodeLine{00040\ }
\DoxyCodeLine{00041\ }
\DoxyCodeLine{00042\ }
\DoxyCodeLine{00043\ }
\DoxyCodeLine{00047\ \textcolor{keyword}{struct\ }\mbox{\hyperlink{structADS1115settings}{ADS1115settings}}\ \{}
\DoxyCodeLine{00048\ }
\DoxyCodeLine{00052\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structADS1115settings_ae0f3b1d6ef8068fed5e580fd4d7123b3}{i2c\_bus}}\ =\ 1;}
\DoxyCodeLine{00053\ }
\DoxyCodeLine{00057\ \ \ \ \ uint8\_t\ \mbox{\hyperlink{structADS1115settings_a5aac9fb517c9665aeca60f1a9b0bbbe2}{address}}\ =\ DEFAULT\_ADS1115\_ADDRESS;}
\DoxyCodeLine{00058\ }
\DoxyCodeLine{00062\ \ \ \ \ \textcolor{keyword}{enum}\ \mbox{\hyperlink{structADS1115settings_aa3a33d5f6c7f14bb708a70499a225357}{SamplingRates}}\ \{}
\DoxyCodeLine{00063\ \ \ \ \ FS8HZ\ \ \ =\ 0,}
\DoxyCodeLine{00064\ \ \ \ \ FS16HZ\ \ =\ 1,}
\DoxyCodeLine{00065\ \ \ \ \ FS32HZ\ \ =\ 2,}
\DoxyCodeLine{00066\ \ \ \ \ FS64HZ\ \ =\ 3,}
\DoxyCodeLine{00067\ \ \ \ \ FS128HZ\ =\ 4,}
\DoxyCodeLine{00068\ \ \ \ \ FS250HZ\ =\ 5,}
\DoxyCodeLine{00069\ \ \ \ \ FS475HZ\ =\ 6,}
\DoxyCodeLine{00070\ \ \ \ \ FS860HZ\ =\ 7}
\DoxyCodeLine{00071\ \ \ \ \ \};}
\DoxyCodeLine{00072\ \ \ \ \ }
\DoxyCodeLine{00076\ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{unsigned}\ \mbox{\hyperlink{structADS1115settings_ab4314bdcd3638815129e97458ca43950}{getSamplingRate}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keyword}{const}\ \textcolor{keywordtype}{unsigned}\ SamplingRateEnum2Value[8]\ =}
\DoxyCodeLine{00078\ \ \ \ \ \ \ \ \ \{8,16,32,64,128,250,475,860\};}
\DoxyCodeLine{00079\ \ \ \ \ \textcolor{keywordflow}{return}\ SamplingRateEnum2Value[\mbox{\hyperlink{structADS1115settings_aab5ef57bb9aef08aac7a7fd7de33a451}{samplingRate}}];}
\DoxyCodeLine{00080\ \ \ \ \ \}}
\DoxyCodeLine{00081\ }
\DoxyCodeLine{00085\ \ \ \ \ \mbox{\hyperlink{structADS1115settings_aa3a33d5f6c7f14bb708a70499a225357}{SamplingRates}}\ \mbox{\hyperlink{structADS1115settings_aab5ef57bb9aef08aac7a7fd7de33a451}{samplingRate}}\ =\ FS8HZ;}
\DoxyCodeLine{00086\ }
\DoxyCodeLine{00090\ \ \ \ \ \textcolor{keyword}{enum}\ \mbox{\hyperlink{structADS1115settings_a831970032a15754ead970931dd25ac5f}{PGA}}\ \{}
\DoxyCodeLine{00091\ \ \ \ \ FSR2\_048\ =\ 2,}
\DoxyCodeLine{00092\ \ \ \ \ FSR1\_024\ =\ 3,}
\DoxyCodeLine{00093\ \ \ \ \ FSR0\_512\ =\ 4,}
\DoxyCodeLine{00094\ \ \ \ \ FSR0\_256\ =\ 5}
\DoxyCodeLine{00095\ \ \ \ \ \};}
\DoxyCodeLine{00096\ }
\DoxyCodeLine{00100\ \ \ \ \ \mbox{\hyperlink{structADS1115settings_a831970032a15754ead970931dd25ac5f}{PGA}}\ \mbox{\hyperlink{structADS1115settings_a9c5013fdbef7376faec2df49d123e67e}{pgaGain}}\ =\ FSR2\_048;}
\DoxyCodeLine{00101\ }
\DoxyCodeLine{00105\ \ \ \ \ \textcolor{keyword}{enum}\ \mbox{\hyperlink{structADS1115settings_a17845a1a94f94bb7d2406dbe13bc560d}{Input}}\ \{}
\DoxyCodeLine{00106\ \ \ \ \ AIN0\ =\ 0,}
\DoxyCodeLine{00107\ \ \ \ \ AIN1\ =\ 1,}
\DoxyCodeLine{00108\ \ \ \ \ AIN2\ =\ 2,}
\DoxyCodeLine{00109\ \ \ \ \ AIN3\ =\ 3}
\DoxyCodeLine{00110\ \ \ \ \ \};}
\DoxyCodeLine{00111\ }
\DoxyCodeLine{00115\ \ \ \ \ \mbox{\hyperlink{structADS1115settings_a17845a1a94f94bb7d2406dbe13bc560d}{Input}}\ \mbox{\hyperlink{structADS1115settings_a3f4f9b2d8b6f0ef724bd4e4a68b75245}{channel}}\ =\ AIN0;}
\DoxyCodeLine{00116\ }
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structADS1115settings_a5b764c1300798718106d83bf76bd2608}{drdy\_chip}}\ =\ 0;}
\DoxyCodeLine{00121\ }
\DoxyCodeLine{00125\ \ \ \ \ \textcolor{keywordtype}{int}\ \mbox{\hyperlink{structADS1115settings_a2ec35347e84e5165a35191e670c05b79}{drdy\_gpio}}\ =\ DEFAULT\_ALERT\_RDY\_TO\_GPIO;}
\DoxyCodeLine{00126\ \};}
\DoxyCodeLine{00127\ }
\DoxyCodeLine{00128\ }
\DoxyCodeLine{00133\ \textcolor{keyword}{class\ }\mbox{\hyperlink{classADS1115rpi}{ADS1115rpi}}\ \{}
\DoxyCodeLine{00134\ }
\DoxyCodeLine{00135\ \textcolor{keyword}{public}:}
\DoxyCodeLine{00140\ \ \ \ \ \mbox{\hyperlink{classADS1115rpi_a3dec47dc3242290468f21396df0d71a5}{\string~ADS1115rpi}}()\ \{}
\DoxyCodeLine{00141\ \ \ \ \ \mbox{\hyperlink{classADS1115rpi_a910b9735f8bef69a0844a821fda06baf}{stop}}();}
\DoxyCodeLine{00142\ \ \ \ \ \}}
\DoxyCodeLine{00143\ }
\DoxyCodeLine{00147\ \ \ \ \ \textcolor{keyword}{using\ }\mbox{\hyperlink{classADS1115rpi_a69806d343269487c97e5d34c9c13902c}{ADSCallbackInterface}}\ =\ std::function<void(\textcolor{keywordtype}{float})>;}
\DoxyCodeLine{00148\ }
\DoxyCodeLine{00149\ \ \ \ \ \textcolor{keywordtype}{void}\ registerCallback(\mbox{\hyperlink{classADS1115rpi_a69806d343269487c97e5d34c9c13902c}{ADSCallbackInterface}}\ ci)\ \{}
\DoxyCodeLine{00150\ \ \ \ \ adsCallbackInterface\ =\ ci;}
\DoxyCodeLine{00151\ \ \ \ \ \}}
\DoxyCodeLine{00152\ }
\DoxyCodeLine{00160\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classADS1115rpi_a4f36d0cca6cbec106b5a626d9973e091}{setChannel}}(\mbox{\hyperlink{structADS1115settings_a17845a1a94f94bb7d2406dbe13bc560d}{ADS1115settings::Input}}\ channel);}
\DoxyCodeLine{00161\ }
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classADS1115rpi_a401e626b6afed688a9b0518c0316b2a9}{start}}(\mbox{\hyperlink{structADS1115settings}{ADS1115settings}}\ settings\ =\ \mbox{\hyperlink{structADS1115settings}{ADS1115settings}}()\ );}
\DoxyCodeLine{00168\ }
\DoxyCodeLine{00172\ \ \ \ \ \mbox{\hyperlink{structADS1115settings}{ADS1115settings}}\ \mbox{\hyperlink{classADS1115rpi_ad8f096a3061f19cda469efe0eee60510}{getADS1115settings}}()\textcolor{keyword}{\ const\ }\{}
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{keywordflow}{return}\ ads1115settings;}
\DoxyCodeLine{00174\ \ \ \ \ \}}
\DoxyCodeLine{00175\ }
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{classADS1115rpi_a910b9735f8bef69a0844a821fda06baf}{stop}}();}
\DoxyCodeLine{00180\ }
\DoxyCodeLine{00181\ \textcolor{keyword}{private}:}
\DoxyCodeLine{00182\ \ \ \ \ \mbox{\hyperlink{structADS1115settings}{ADS1115settings}}\ ads1115settings;}
\DoxyCodeLine{00183\ }
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keywordtype}{void}\ dataReady();}
\DoxyCodeLine{00185\ }
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{keywordtype}{void}\ worker();}
\DoxyCodeLine{00187\ }
\DoxyCodeLine{00188\ \ \ \ \ \textcolor{keywordtype}{void}\ i2c\_writeWord(uint8\_t\ reg,\ \textcolor{keywordtype}{unsigned}\ data);}
\DoxyCodeLine{00189\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ i2c\_readWord(uint8\_t\ reg);}
\DoxyCodeLine{00190\ \ \ \ \ \textcolor{keywordtype}{int}\ i2c\_readConversion();}
\DoxyCodeLine{00191\ }
\DoxyCodeLine{00192\ \ \ \ \ \textcolor{keyword}{const}\ uint8\_t\ reg\_config\ =\ 1;}
\DoxyCodeLine{00193\ \ \ \ \ \textcolor{keyword}{const}\ uint8\_t\ reg\_lo\_thres\ =\ 2;}
\DoxyCodeLine{00194\ \ \ \ \ \textcolor{keyword}{const}\ uint8\_t\ reg\_hi\_thres\ =\ 3;}
\DoxyCodeLine{00195\ }
\DoxyCodeLine{00196\ \ \ \ \ \textcolor{keywordtype}{float}\ fullScaleVoltage()\ \{}
\DoxyCodeLine{00197\ \ \ \ \ \textcolor{keywordflow}{switch}\ (ads1115settings.\mbox{\hyperlink{structADS1115settings_a9c5013fdbef7376faec2df49d123e67e}{pgaGain}})\ \{}
\DoxyCodeLine{00198\ \ \ \ \ \textcolor{keywordflow}{case}\ ADS1115settings::FSR2\_048:}
\DoxyCodeLine{00199\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 2.048f;}
\DoxyCodeLine{00200\ \ \ \ \ \textcolor{keywordflow}{case}\ ADS1115settings::FSR1\_024:}
\DoxyCodeLine{00201\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 1.024f;}
\DoxyCodeLine{00202\ \ \ \ \ \textcolor{keywordflow}{case}\ ADS1115settings::FSR0\_512:}
\DoxyCodeLine{00203\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0.512f;}
\DoxyCodeLine{00204\ \ \ \ \ \textcolor{keywordflow}{case}\ ADS1115settings::FSR0\_256:}
\DoxyCodeLine{00205\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ 0.256f;}
\DoxyCodeLine{00206\ \ \ \ \ \}}
\DoxyCodeLine{00207\ \ \ \ \ assert(1\ ==\ 0);}
\DoxyCodeLine{00208\ \ \ \ \ \textcolor{keywordflow}{return}\ 0;}
\DoxyCodeLine{00209\ \ \ \ \ \}}
\DoxyCodeLine{00210\ }
\DoxyCodeLine{00211\ \ \ \ \ std::shared\_ptr<gpiod::chip>\ chip;}
\DoxyCodeLine{00212\ \ \ \ \ std::shared\_ptr<gpiod::line\_request>\ request;}
\DoxyCodeLine{00213\ \ \ \ \ }
\DoxyCodeLine{00214\ \ \ \ \ std::thread\ thr;}
\DoxyCodeLine{00215\ }
\DoxyCodeLine{00216\ \ \ \ \ \textcolor{keywordtype}{int}\ fd\_i2c\ =\ -\/1;}
\DoxyCodeLine{00217\ }
\DoxyCodeLine{00218\ \ \ \ \ \textcolor{keywordtype}{bool}\ running\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00219\ }
\DoxyCodeLine{00220\ \ \ \ \ \mbox{\hyperlink{classADS1115rpi_a69806d343269487c97e5d34c9c13902c}{ADSCallbackInterface}}\ adsCallbackInterface;}
\DoxyCodeLine{00221\ \};}
\DoxyCodeLine{00222\ }
\DoxyCodeLine{00223\ }
\DoxyCodeLine{00224\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
